import{_ as h}from"./plugin-vue_export-helper-x3n3nnut.js";import{r as o,o as e,c as a,a as n,b as t,d,e as s,f as l}from"./app-VKLC1A-x.js";const g="/mynotes/assets/范式建模与维度建模_1-p7UY0aMC.png",i={},p=t("p",null,"介绍范式建模和维度建模两种建模思想，通过具体的建模实践，使用两种建模方式进行建模比较",-1),b=t("h1",{id:"范式建模与维度建模",tabindex:"-1"},[t("a",{class:"header-anchor",href:"#范式建模与维度建模","aria-hidden":"true"},"#"),d(" 范式建模与维度建模")],-1),c={href:"https://mp.weixin.qq.com/s/-W4Fh3fDhMJTyj92RuNOaw",target:"_blank",rel:"noopener noreferrer"},m=l('<h2 id="两种建模思想" tabindex="-1"><a class="header-anchor" href="#两种建模思想" aria-hidden="true">#</a> 两种建模思想</h2><h3 id="范式建模" tabindex="-1"><a class="header-anchor" href="#范式建模" aria-hidden="true">#</a> 范式建模</h3><p>范式建模是数仓之父 Inmon 所倡导的，“数据仓库”这个词就是这位大师所定义的，这种建模方式在范式理论上符合 3NF，这里的 3NF 与 OLTP 中的 3NF 还是有点区别的：<em><strong>关系数据库中的 3NF 是针对具体的业务流程的实体对象关系抽象，而数据仓库的 3NF 是站在企业角度面向主题的抽象</strong></em></p><p>范式建模从流程上看是<strong>自上而下</strong>的，自上而下指的是数据的流向，“上”即数据的上游，“下”即数据的下游，即从<em><strong>分散异构的数据源 -&gt; 数据仓库 -&gt; 数据集市</strong></em>。<strong>以数据源头为导向</strong>，然后一步步探索获取尽量符合预期的数据，因为数据源往往是异构的，所以会更加强调数据的清洗工作，将数据抽取为<strong>实体-关系</strong>模型，并不强调事实表和维度表的概念</p><h3 id="维度建模" tabindex="-1"><a class="header-anchor" href="#维度建模" aria-hidden="true">#</a> 维度建模</h3><p>维度建模从流程上看是<strong>自下而上</strong>的，即从<em><strong>数据集市-&gt; 数据仓库 -&gt; 分散异构的数据源</strong></em>。维度建模<strong>以最终任务为导向</strong>，将数据按照目标拆分出不同的表需求，数据会抽取为<strong>事实-维度</strong>模型，<strong>数据源经 ETL 转化为事实表和维度表导入数据集市</strong>，以星型模型或雪花模型等方式构建维度数据仓库，架构体系中，数据集市与数据仓库是紧密结合的，<strong>数据集市是数据仓库中一个逻辑上的主题域</strong></p><h2 id="两种建模实践" tabindex="-1"><a class="header-anchor" href="#两种建模实践" aria-hidden="true">#</a> 两种建模实践</h2><h3 id="源表结构及数据" tabindex="-1"><a class="header-anchor" href="#源表结构及数据" aria-hidden="true">#</a> 源表结构及数据</h3><p>此处以简化后的电商购物为例，对于大数据平台来说，源表指的电商系统中后台数据库中的表，这种表一般都是 OLTP 类型的表：</p><ol><li><strong>用户信息表</strong></li></ol><table><thead><tr><th>用户ID</th><th>昵称</th><th>姓名</th><th>性别</th><th>联系方式</th><th>地区</th><th>用户等级ID</th><th>创建时间</th><th>修改时间</th><th>是否注销</th></tr></thead><tbody><tr><td>1001</td><td>小忆控</td><td>张翠花</td><td>女</td><td>15034951345</td><td>0310</td><td>2</td><td>2021-04-03 13:11:01</td><td>2021-04-04 15:16:00</td><td>0</td></tr><tr><td>1002</td><td>池木</td><td>李建国</td><td>男</td><td>17834686673</td><td>0311</td><td>1</td><td>2021-04-03 14:11:01</td><td>2021-04-04 15:26:01</td><td>0</td></tr><tr><td>1003</td><td>君勿笑</td><td>刘素芬</td><td>女</td><td>15687876464</td><td>0312</td><td>1</td><td>2021-04-03 15:11:01</td><td>2021-04-04 16:16:00</td><td>0</td></tr><tr><td>1004</td><td>原野</td><td>王富贵</td><td>男</td><td>15013145210</td><td>0313</td><td>3</td><td>2021-04-03 15:23:01</td><td>2021-04-04 17:16:00</td><td>1</td></tr></tbody></table><ol start="2"><li><strong>城市信息表</strong></li></ol><table><thead><tr><th>城市ID</th><th>省</th><th>市</th></tr></thead><tbody><tr><td>0310</td><td>河北</td><td>邯郸</td></tr><tr><td>0311</td><td>河北</td><td>石家庄</td></tr><tr><td>0312</td><td>河北</td><td>保定</td></tr><tr><td>0313</td><td>河北</td><td>张家口</td></tr></tbody></table><ol start="3"><li><strong>用户等级表</strong></li></ol><table><thead><tr><th>用户等级ID</th><th>价值属性</th></tr></thead><tbody><tr><td>1</td><td>重要价值用户</td></tr><tr><td>2</td><td>一般价值用户</td></tr><tr><td>3</td><td>一般发展用户</td></tr></tbody></table><ol start="4"><li><strong>用户订单表</strong></li></ol><table><thead><tr><th>订单ID</th><th>用户ID</th><th>订单状态</th><th>商品ID</th><th>商品总额</th><th>下单时间</th><th>支付金额</th><th>支付类型</th></tr></thead><tbody><tr><td>OR11001</td><td>1001</td><td>未支付</td><td>CO31243</td><td>122.00</td><td>2021-04-04 10:12:05</td><td>0.00</td><td></td></tr><tr><td>OR11002</td><td>1002</td><td>已支付</td><td>CO54353</td><td>86.50</td><td>2021-04-04 11:12:05</td><td>86.50</td><td>支付宝</td></tr><tr><td>OR11003</td><td>1003</td><td>已支付</td><td>CO43253</td><td>46.00</td><td>2021-04-04 14:16:05</td><td>0.00</td><td>助力免费</td></tr><tr><td>OR11004</td><td>1002</td><td>已支付</td><td>CO34235</td><td>210.00</td><td>2021-04-04 11:12:05</td><td>210.00</td><td>支付宝</td></tr></tbody></table><h3 id="使用范式建模" tabindex="-1"><a class="header-anchor" href="#使用范式建模" aria-hidden="true">#</a> 使用范式建模</h3><p>使用范式建模对以上源表数据进行建模，需要将数据抽取为<strong>实体-关系</strong>模式，根据源表的数据，将表拆分为：用户实体表，订单实体表，城市信息实体表，用户与城市信息关系表，用户与用户等级关系表等多个子模块</p><ol><li><strong>用户实体表</strong></li></ol><p>（注：ETL 已过滤掉注销用户）</p><table><thead><tr><th>用户ID</th><th>姓名</th><th>性别</th><th>联系方式</th><th>地区</th><th>用户等级ID</th><th>创建时间</th><th>修改时间</th></tr></thead><tbody><tr><td>1001</td><td>张翠花</td><td>女</td><td>15034951345</td><td>0310</td><td>2</td><td>2021-04-03 13:11:01</td><td>2021-04-04 15:16:00</td></tr><tr><td>1002</td><td>李建国</td><td>男</td><td>17834686673</td><td>0311</td><td>1</td><td>2021-04-03 14:11:01</td><td>2021-04-04 15:26:01</td></tr><tr><td>1003</td><td>刘素芬</td><td>女</td><td>15687876464</td><td>0312</td><td>1</td><td>2021-04-03 15:11:01</td><td>2021-04-04 16:16:00</td></tr></tbody></table><ol start="2"><li><strong>支付成功订单实体表</strong></li></ol><table><thead><tr><th>订单ID</th><th>用户ID</th><th>商品ID</th><th>商品总额</th><th>下单时间</th><th>支付金额</th><th>支付类型</th></tr></thead><tbody><tr><td>OR11002</td><td>1002</td><td>CO54353</td><td>86.50</td><td>2021-04-04 11:12:05</td><td>86.50</td><td>支付宝</td></tr><tr><td>OR11003</td><td>1003</td><td>CO43253</td><td>46.00</td><td>2021-04-04 14:16:05</td><td>0.00</td><td>助力免费</td></tr><tr><td>OR11004</td><td>1002</td><td>CO34235</td><td>210.00</td><td>2021-04-04 11:12:05</td><td>210.00</td><td>支付宝</td></tr></tbody></table><ol start="3"><li><strong>城市信息实体表</strong></li></ol><table><thead><tr><th>城市ID</th><th>省</th><th>市</th></tr></thead><tbody><tr><td>0310</td><td>河北</td><td>邯郸</td></tr><tr><td>0311</td><td>河北</td><td>石家庄</td></tr><tr><td>0312</td><td>河北</td><td>保定</td></tr><tr><td>0313</td><td>河北</td><td>张家口</td></tr></tbody></table><ol start="4"><li><strong>订单与用户关系表</strong></li></ol><table><thead><tr><th>订单ID</th><th>用户ID</th></tr></thead><tbody><tr><td>OR11002</td><td>1002</td></tr><tr><td>OR11003</td><td>1003</td></tr><tr><td>OR11004</td><td>1002</td></tr></tbody></table><ol start="5"><li><strong>用户与城市信息关系表</strong></li></ol><table><thead><tr><th>用户ID</th><th>城市ID</th></tr></thead><tbody><tr><td>1001</td><td>0310</td></tr><tr><td>1002</td><td>0311</td></tr><tr><td>1003</td><td>0312</td></tr></tbody></table><ol start="6"><li><strong>用户与用户等级关系表</strong></li></ol><table><thead><tr><th>用户ID</th><th>用户等级ID</th></tr></thead><tbody><tr><td>1001</td><td>2</td></tr><tr><td>1002</td><td>1</td></tr><tr><td>1003</td><td>1</td></tr></tbody></table><p>通过以上可以发现，范式建模就是将源表抽取为实体表，关系表，所以范式建模即是<strong>实体关系（ER）模型</strong>。数据没有冗余，符合<strong>三范式</strong>设计规范</p><h3 id="使用维度建模" tabindex="-1"><a class="header-anchor" href="#使用维度建模" aria-hidden="true">#</a> 使用维度建模</h3><p>使用维度建模，需要将数据抽取为<strong>事实表和维度表</strong>，根据源表数据，将表拆分为：订单事实表，用户维度表，城市信息维度表，用户等级维度表</p><p>可以看出，<strong>在维度建模中，不需要单独维护数据关系表，因为关系已经冗余在事实表和维度表中</strong></p><ol><li><strong>支付成功订单事实表</strong></li></ol><table><thead><tr><th>订单ID</th><th>用户ID</th><th>商品ID</th><th>商品总额</th><th>下单时间</th><th>支付金额</th><th>支付类型</th></tr></thead><tbody><tr><td>OR11002</td><td>1002</td><td>CO54353</td><td>86.50</td><td>2021-04-04 11:12:05</td><td>86.50</td><td>支付宝</td></tr><tr><td>OR11003</td><td>1003</td><td>CO43253</td><td>46.00</td><td>2021-04-04 14:16:05</td><td>0.00</td><td>助力免费</td></tr><tr><td>OR11004</td><td>1002</td><td>CO34235</td><td>210.00</td><td>2021-04-04 11:12:05</td><td>210.00</td><td>支付宝</td></tr></tbody></table><ol start="2"><li><strong>用户维度表</strong></li></ol><table><thead><tr><th>用户ID</th><th>姓名</th><th>性别</th><th>联系方式</th><th>地区</th><th>用户等级ID</th><th>创建时间</th><th>修改时间</th></tr></thead><tbody><tr><td>1001</td><td>张翠花</td><td>女</td><td>15034951345</td><td>0310</td><td>2</td><td>2021-04-03 13:11:01</td><td>2021-04-04 15:16:00</td></tr><tr><td>1002</td><td>李建国</td><td>男</td><td>17834686673</td><td>0311</td><td>1</td><td>2021-04-03 14:11:01</td><td>2021-04-04 15:26:01</td></tr><tr><td>1003</td><td>刘素芬</td><td>女</td><td>15687876464</td><td>0312</td><td>1</td><td>2021-04-03 15:11:01</td><td>2021-04-04 16:16:00</td></tr></tbody></table><ol start="3"><li><strong>城市信息维度表</strong></li></ol><table><thead><tr><th>城市ID</th><th>省</th><th>市</th></tr></thead><tbody><tr><td>0310</td><td>河北</td><td>邯郸</td></tr><tr><td>0311</td><td>河北</td><td>石家庄</td></tr><tr><td>0312</td><td>河北</td><td>保定</td></tr><tr><td>0313</td><td>河北</td><td>张家口</td></tr></tbody></table><ol start="4"><li><strong>用户等级维度表</strong></li></ol><table><thead><tr><th>用户等级ID</th><th>价值属性</th></tr></thead><tbody><tr><td>1</td><td>重要价值用户</td></tr><tr><td>2</td><td>一般价值用户</td></tr><tr><td>3</td><td>一般发展用户</td></tr></tbody></table><p>上表之间的关系如图所示：</p><figure><img src="'+g+'" alt="维度建模表之间的关系" tabindex="0" loading="lazy"><figcaption>维度建模表之间的关系</figcaption></figure><p>根据上图可见，这是典型的<strong>雪花模型</strong>，其特点就是维度表可以拥有其他维度表</p><h2 id="两种建模对比" tabindex="-1"><a class="header-anchor" href="#两种建模对比" aria-hidden="true">#</a> 两种建模对比</h2><h3 id="两种建模方式特点" tabindex="-1"><a class="header-anchor" href="#两种建模方式特点" aria-hidden="true">#</a> 两种建模方式特点</h3><ul><li><p><strong>范式建模</strong>：</p><ul><li><p><strong>优点</strong>：</p><p><em><strong>1&gt;</strong></em> 能够结合业务系统的数据模型，较方便的实现数据仓库的模型</p><p><em><strong>2&gt;</strong></em> 同一份数据只存放在一个地方，没有数据冗余，保证了数据一致性</p><p><em><strong>3&gt;</strong></em> 数据解耦，方便维护</p></li><li><p><strong>缺点</strong>：</p><p><em><strong>1&gt;</strong></em> 表的数量多</p><p><em><strong>2&gt;</strong></em> 查询时关联表较多使得查询性能降低</p></li></ul></li><li><p><strong>维度建模</strong>：</p><ul><li><p><strong>优点</strong>：</p><p><em><strong>1&gt;</strong></em> 模型结构简单，面向分析</p><p><em><strong>2&gt;</strong></em> 为了提高查询性能可以增加数据冗余，反规范化的设计</p><p><em><strong>3&gt;</strong></em> 开发周期短，能够快速迭代</p></li><li><p><strong>缺点</strong>：</p><p><em><strong>1&gt;</strong></em> 缺点就是数据会大量冗余，预处理阶段开销大，后期维护麻烦</p><p><em><strong>2&gt;</strong></em> 不能保证数据口径一致性</p></li></ul></li></ul><h3 id="两种建模方式对比" tabindex="-1"><a class="header-anchor" href="#两种建模方式对比" aria-hidden="true">#</a> 两种建模方式对比</h3><table><thead><tr><th>特性</th><th>维度建模</th><th>范式建模</th></tr></thead><tbody><tr><td>开发周期</td><td>短</td><td>长</td></tr><tr><td>开发难度</td><td>小</td><td>大</td></tr><tr><td>维护难度</td><td>大</td><td>小</td></tr><tr><td>数据要求</td><td>针对具体业务</td><td>站在企业角度</td></tr><tr><td>精心设计</td><td>否</td><td>是</td></tr><tr><td>缓慢变化维</td><td>是</td><td>否</td></tr><tr><td>需要的人员</td><td>少量</td><td>专业团队</td></tr><tr><td>数据模型</td><td>维度建模，星型模型、雪花模型</td><td>实体-关系模型，准三范式设计</td></tr></tbody></table><p>互联网公司的业务一般是周期比较短需求变化快，并且迭代频繁，精心设计实体-关系的范式建模似乎并不能满足快速迭代的业务需要。所以，<strong>互联网公司更多场景下趋向于使用维度-事实的维度建模反而可以更快地完成任务</strong></p><h2 id="两种建模混合场景" tabindex="-1"><a class="header-anchor" href="#两种建模混合场景" aria-hidden="true">#</a> 两种建模混合场景</h2><p>范式建模必须符合准三范式设计规范，如果使用混合建模，则源表也需要符合范式建模的限制，即源数据须为<strong>操作型</strong>或<strong>事务型</strong>系统的数据。通过 ETL 抽取转换和加载到数据仓库的 ODS 层，ODS 层数据与源数据是保持一致的，所以 ODS 层数据也是符合范式设计规范的，<strong>通过 ODS 的数据，利用范式建模方法，建设原子数据的数据仓库 EDW，然后基于 EDW，利用维度建模方法建设数据集市</strong></p><p>结合两种建模方式的各自规范，混合建模按照“<strong>松耦合、层次化</strong>”的基本架构原则进行实施。混合数据仓库架构方法主要包含以下关键步骤：业务需求分步构建、分层次保存数据、整合原子级的数据标准、维护一致性维度等</p><p>建模方式没有好与坏之分，只有合适与不合适之分，在实际数仓建设中，需要灵活多变，不能全依赖建模理论，也不能不依赖。适时变通，才能建设一个好的数据仓库</p>',57);function _(y,D){const r=o("ExternalLinkIcon");return e(),a("div",null,[p,n(" more "),b,t("p",null,[d("参考资料："),t("a",c,[d("通俗易懂数仓建模—Inmon范式建模与Kimball维度建模"),s(r)])]),m])}const f=h(i,[["render",_],["__file","范式建模与维度建模.html.vue"]]);export{f as default};
