import{_ as t}from"./plugin-vue_export-helper-x3n3nnut.js";import{r as o,o as e,c,a as l,b as n,d as s,e as u,f as a}from"./app-VKLC1A-x.js";const i={},k=n("p",null,"一些较为经典的 SQL 练习题，包括不等值关联、区间筛选、拉链表利息等",-1),r=a(`<h1 id="sql-练习题" tabindex="-1"><a class="header-anchor" href="#sql-练习题" aria-hidden="true">#</a> SQL 练习题</h1><h2 id="参加全部考试问题" tabindex="-1"><a class="header-anchor" href="#参加全部考试问题" aria-hidden="true">#</a> 参加全部考试问题</h2><blockquote><p>现在有三张数据表，一张为学生信息表 STUDENTS，一张为学生分数表 SCORE，还有一张为年级课程表 CLASS，用一条 SQL 查询出每个年级参加了所有科目考试的学生的总人数</p></blockquote><div class="language-sql line-numbers-mode" data-ext="sql"><pre class="language-sql"><code><span class="token comment">-- 数据准备</span>
<span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> STUDENTS<span class="token punctuation">(</span>
                      SNO   VARCHAR2<span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">)</span>
                     <span class="token punctuation">,</span>SNAME VARCHAR2<span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">)</span>
                     <span class="token punctuation">,</span>AGE   NUMBER
                     <span class="token punctuation">,</span>GRADE NUMBER
                     <span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> STUDENTS <span class="token keyword">VALUES</span> <span class="token punctuation">(</span><span class="token string">&#39;001&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;张三&#39;</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> STUDENTS <span class="token keyword">VALUES</span> <span class="token punctuation">(</span><span class="token string">&#39;002&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;李四&#39;</span><span class="token punctuation">,</span> <span class="token number">7</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> STUDENTS <span class="token keyword">VALUES</span> <span class="token punctuation">(</span><span class="token string">&#39;004&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;卫国&#39;</span><span class="token punctuation">,</span> <span class="token number">7</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> STUDENTS <span class="token keyword">VALUES</span> <span class="token punctuation">(</span><span class="token string">&#39;003&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;王五&#39;</span><span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">COMMIT</span><span class="token punctuation">;</span>

<span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> SCORE<span class="token punctuation">(</span>
                   SNO   VARCHAR2<span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">)</span>
                  <span class="token punctuation">,</span>CLASS VARCHAR2<span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">)</span>
                  <span class="token punctuation">,</span>SCORE NUMBER
                  <span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> SCORE <span class="token keyword">VALUES</span> <span class="token punctuation">(</span><span class="token string">&#39;001&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;语文&#39;</span><span class="token punctuation">,</span> <span class="token number">88</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> SCORE <span class="token keyword">VALUES</span> <span class="token punctuation">(</span><span class="token string">&#39;001&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;数学&#39;</span><span class="token punctuation">,</span> <span class="token number">79</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> SCORE <span class="token keyword">VALUES</span> <span class="token punctuation">(</span><span class="token string">&#39;002&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;数学&#39;</span><span class="token punctuation">,</span> <span class="token number">85</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> SCORE <span class="token keyword">VALUES</span> <span class="token punctuation">(</span><span class="token string">&#39;003&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;语文&#39;</span><span class="token punctuation">,</span> <span class="token number">95</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> SCORE <span class="token keyword">VALUES</span> <span class="token punctuation">(</span><span class="token string">&#39;003&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;数学&#39;</span><span class="token punctuation">,</span> <span class="token number">80</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> SCORE <span class="token keyword">VALUES</span> <span class="token punctuation">(</span><span class="token string">&#39;003&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;英语&#39;</span><span class="token punctuation">,</span> <span class="token number">60</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> SCORE <span class="token keyword">VALUES</span> <span class="token punctuation">(</span><span class="token string">&#39;004&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;语文&#39;</span><span class="token punctuation">,</span> <span class="token number">95</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> SCORE <span class="token keyword">VALUES</span> <span class="token punctuation">(</span><span class="token string">&#39;004&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;数学&#39;</span><span class="token punctuation">,</span> <span class="token number">95</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">COMMIT</span><span class="token punctuation">;</span>

<span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> CLASS <span class="token punctuation">(</span>
                    GRADE NUMBER
                   <span class="token punctuation">,</span>CLASS VARCHAR2<span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span>
                   <span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> CLASS <span class="token keyword">VALUES</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token string">&#39;语文&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> CLASS <span class="token keyword">VALUES</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token string">&#39;数学&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> CLASS <span class="token keyword">VALUES</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token string">&#39;语文&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> CLASS <span class="token keyword">VALUES</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token string">&#39;数学&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> CLASS <span class="token keyword">VALUES</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token string">&#39;语文&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> CLASS <span class="token keyword">VALUES</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token string">&#39;数学&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> CLASS <span class="token keyword">VALUES</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token string">&#39;英语&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">COMMIT</span><span class="token punctuation">;</span>

<span class="token comment">-- 查询每个年级参加了所有科目考试的学生的总人数</span>
<span class="token keyword">SELECT</span> <span class="token function">COUNT</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span> COUNT_1
<span class="token keyword">FROM</span> <span class="token punctuation">(</span>
      <span class="token keyword">SELECT</span> T1<span class="token punctuation">.</span>SNO
            <span class="token punctuation">,</span>T1<span class="token punctuation">.</span>GRADE
            <span class="token punctuation">,</span><span class="token function">COUNT</span><span class="token punctuation">(</span>T<span class="token punctuation">.</span>CLASS<span class="token punctuation">)</span> CLASS_COUNT  <span class="token comment">-- 参加考试的课程数量</span>
      <span class="token keyword">FROM</span> SCORE T
      <span class="token keyword">LEFT</span> <span class="token keyword">JOIN</span> STUDENTS T1
             <span class="token keyword">ON</span> T<span class="token punctuation">.</span>SNO <span class="token operator">=</span> T1<span class="token punctuation">.</span>SNO
      <span class="token keyword">GROUP</span> <span class="token keyword">BY</span> T1<span class="token punctuation">.</span>SNO<span class="token punctuation">,</span> T1<span class="token punctuation">.</span>GRADE
     <span class="token punctuation">)</span> T2
<span class="token keyword">INNER</span> <span class="token keyword">JOIN</span> <span class="token punctuation">(</span>
            <span class="token keyword">SELECT</span> T<span class="token punctuation">.</span>GRADE
                 <span class="token punctuation">,</span><span class="token function">COUNT</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span> CLASS_COUNT  <span class="token comment">-- 每个年级的课程数量</span>
            <span class="token keyword">FROM</span> CLASS T
            <span class="token keyword">GROUP</span> <span class="token keyword">BY</span> T<span class="token punctuation">.</span>GRADE
           <span class="token punctuation">)</span> T3
        <span class="token keyword">ON</span> T2<span class="token punctuation">.</span>GRADE <span class="token operator">=</span> T3<span class="token punctuation">.</span>GRADE <span class="token operator">AND</span> T2<span class="token punctuation">.</span>CLASS_COUNT <span class="token operator">=</span> T3<span class="token punctuation">.</span>CLASS_COUNT<span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="不等值关联" tabindex="-1"><a class="header-anchor" href="#不等值关联" aria-hidden="true">#</a> 不等值关联</h2><h3 id="拥有共同客户问题" tabindex="-1"><a class="header-anchor" href="#拥有共同客户问题" aria-hidden="true">#</a> 拥有共同客户问题</h3><blockquote><p>输出产品与产品之间持有余额重叠客的客户数</p></blockquote><div class="language-sql line-numbers-mode" data-ext="sql"><pre class="language-sql"><code><span class="token comment">-- 数据准备</span>
<span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> REPORT_CUST_PROD_AUM_STATS<span class="token punctuation">(</span>
                                        CUST_NO   VARCHAR2<span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">)</span>
                                       <span class="token punctuation">,</span>PROD_CODE VARCHAR2<span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">)</span>
                                       <span class="token punctuation">,</span>AUM       NUMBER
                                       <span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> REPORT_CUST_PROD_AUM_STATS <span class="token keyword">VALUES</span> <span class="token punctuation">(</span><span class="token string">&#39;00001&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;001234&#39;</span><span class="token punctuation">,</span> <span class="token number">10000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> REPORT_CUST_PROD_AUM_STATS <span class="token keyword">VALUES</span> <span class="token punctuation">(</span><span class="token string">&#39;00001&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;000330&#39;</span><span class="token punctuation">,</span> <span class="token number">5000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> REPORT_CUST_PROD_AUM_STATS <span class="token keyword">VALUES</span> <span class="token punctuation">(</span><span class="token string">&#39;00002&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;000397&#39;</span><span class="token punctuation">,</span> <span class="token number">8000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> REPORT_CUST_PROD_AUM_STATS <span class="token keyword">VALUES</span> <span class="token punctuation">(</span><span class="token string">&#39;00003&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;400141&#39;</span><span class="token punctuation">,</span> <span class="token number">20000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> REPORT_CUST_PROD_AUM_STATS <span class="token keyword">VALUES</span> <span class="token punctuation">(</span><span class="token string">&#39;00001&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;400141&#39;</span><span class="token punctuation">,</span> <span class="token number">2000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> REPORT_CUST_PROD_AUM_STATS <span class="token keyword">VALUES</span> <span class="token punctuation">(</span><span class="token string">&#39;00004&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;000600&#39;</span><span class="token punctuation">,</span> <span class="token number">50000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> REPORT_CUST_PROD_AUM_STATS <span class="token keyword">VALUES</span> <span class="token punctuation">(</span><span class="token string">&#39;00001&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;000600&#39;</span><span class="token punctuation">,</span> <span class="token number">50000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> REPORT_CUST_PROD_AUM_STATS <span class="token keyword">VALUES</span> <span class="token punctuation">(</span><span class="token string">&#39;00003&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;000600&#39;</span><span class="token punctuation">,</span> <span class="token number">50000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">COMMIT</span><span class="token punctuation">;</span>

<span class="token comment">-- 输出产品与产品之间持有余额重叠客的客户数</span>
<span class="token keyword">SELECT</span> T1<span class="token punctuation">.</span>PROD_CODE
      <span class="token punctuation">,</span>T2<span class="token punctuation">.</span>PROD_CODE
      <span class="token punctuation">,</span><span class="token function">COUNT</span><span class="token punctuation">(</span>T1<span class="token punctuation">.</span>CUST_NO<span class="token punctuation">)</span> COUNT_1
<span class="token keyword">FROM</span> REPORT_CUST_PROD_AUM_STATS T1
<span class="token keyword">INNER</span> <span class="token keyword">JOIN</span> REPORT_CUST_PROD_AUM_STATS T2
        <span class="token keyword">ON</span> T1<span class="token punctuation">.</span>CUST_NO <span class="token operator">=</span> T2<span class="token punctuation">.</span>CUST_NO
       <span class="token operator">AND</span> T1<span class="token punctuation">.</span>PROD_CODE <span class="token operator">&lt;</span> T2<span class="token punctuation">.</span>PROD_CODE
<span class="token keyword">GROUP</span> <span class="token keyword">BY</span> T1<span class="token punctuation">.</span>PROD_CODE<span class="token punctuation">,</span> T2<span class="token punctuation">.</span>PROD_CODE<span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="上一个工作日问题" tabindex="-1"><a class="header-anchor" href="#上一个工作日问题" aria-hidden="true">#</a> 上一个工作日问题</h3><blockquote><p>查询出每个日期的上一个工作日是哪天，是否为工作日要以 WORK_FLAG 的数据为准</p></blockquote><div class="language-sql line-numbers-mode" data-ext="sql"><pre class="language-sql"><code><span class="token comment">-- 数据准备</span>
<span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> WORK_DATE<span class="token punctuation">(</span>
                       W_DATE    <span class="token keyword">DATE</span>  <span class="token comment">-- 日期</span>
                      <span class="token punctuation">,</span>WORK_FLAG VARCHAR2<span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span>  <span class="token comment">-- 是否为工作日</span>
                      <span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> WORK_DATE <span class="token keyword">VALUES</span> <span class="token punctuation">(</span>TO_DATE<span class="token punctuation">(</span><span class="token number">20220817</span><span class="token punctuation">,</span> <span class="token string">&#39;YYYYMMDD&#39;</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">&#39;Y&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> WORK_DATE <span class="token keyword">VALUES</span> <span class="token punctuation">(</span>TO_DATE<span class="token punctuation">(</span><span class="token number">20220818</span><span class="token punctuation">,</span> <span class="token string">&#39;YYYYMMDD&#39;</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">&#39;Y&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> WORK_DATE <span class="token keyword">VALUES</span> <span class="token punctuation">(</span>TO_DATE<span class="token punctuation">(</span><span class="token number">20220819</span><span class="token punctuation">,</span> <span class="token string">&#39;YYYYMMDD&#39;</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">&#39;Y&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> WORK_DATE <span class="token keyword">VALUES</span> <span class="token punctuation">(</span>TO_DATE<span class="token punctuation">(</span><span class="token number">20220820</span><span class="token punctuation">,</span> <span class="token string">&#39;YYYYMMDD&#39;</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">&#39;Y&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> WORK_DATE <span class="token keyword">VALUES</span> <span class="token punctuation">(</span>TO_DATE<span class="token punctuation">(</span><span class="token number">20220821</span><span class="token punctuation">,</span> <span class="token string">&#39;YYYYMMDD&#39;</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">&#39;N&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> WORK_DATE <span class="token keyword">VALUES</span> <span class="token punctuation">(</span>TO_DATE<span class="token punctuation">(</span><span class="token number">20220822</span><span class="token punctuation">,</span> <span class="token string">&#39;YYYYMMDD&#39;</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">&#39;Y&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> WORK_DATE <span class="token keyword">VALUES</span> <span class="token punctuation">(</span>TO_DATE<span class="token punctuation">(</span><span class="token number">20220823</span><span class="token punctuation">,</span> <span class="token string">&#39;YYYYMMDD&#39;</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">&#39;Y&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">COMMIT</span><span class="token punctuation">;</span>

<span class="token comment">-- 查询每个日期的上一个工作日</span>
<span class="token keyword">SELECT</span> T1<span class="token punctuation">.</span>W_DATE      日期
      <span class="token punctuation">,</span><span class="token function">MAX</span><span class="token punctuation">(</span>T2<span class="token punctuation">.</span>W_DATE<span class="token punctuation">)</span> 上一个工作日
<span class="token keyword">FROM</span> WORK_DATE T1
<span class="token keyword">LEFT</span> <span class="token keyword">JOIN</span> WORK_DATE T2
       <span class="token keyword">ON</span> T1<span class="token punctuation">.</span>W_DATE <span class="token operator">&gt;</span> T2<span class="token punctuation">.</span>W_DATE
      <span class="token operator">AND</span> T2<span class="token punctuation">.</span>WORK_FLAG <span class="token operator">=</span> <span class="token string">&#39;Y&#39;</span>
<span class="token keyword">GROUP</span> <span class="token keyword">BY</span> T1<span class="token punctuation">.</span>W_DATE
<span class="token keyword">ORDER</span> <span class="token keyword">BY</span> T1<span class="token punctuation">.</span>W_DATE<span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="欠费金额累计" tabindex="-1"><a class="header-anchor" href="#欠费金额累计" aria-hidden="true">#</a> 欠费金额累计</h3>`,12),d=n("p",null,"有一张表 owing_money，字段分别是：开始时间 start_date，结束时间 end_date，欠费金额 amount。示例数据如下：",-1),v=n("p",null,"2015-03-02, 2015-03-05, 10",-1),T=n("p",null,"2015-03-04, 2015-03-06, 20",-1),m=n("p",null,"要求：查询输出用户从 2015-03-02 到 2015-03-06 每天需要还的金额，示例结果如下：",-1),E=n("p",null,"2015-03-02, 10",-1),b=n("p",null,"2015-03-03, 10",-1),y=n("p",null,"2015-03-04, 30",-1),w=n("p",null,"2015-03-05, 30",-1),A=n("p",null,"2015-03-06, 20",-1),S={href:"https://blog.csdn.net/horses/article/details/107349305",target:"_blank",rel:"noopener noreferrer"},O=a(`<div class="language-sql line-numbers-mode" data-ext="sql"><pre class="language-sql"><code><span class="token comment">-- 数据准备</span>
<span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> owing_money <span class="token punctuation">(</span>
  start_date <span class="token keyword">VARCHAR</span><span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">)</span>
 <span class="token punctuation">,</span>end_date   <span class="token keyword">VARCHAR</span><span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">)</span>
 <span class="token punctuation">,</span>amount     <span class="token keyword">INT</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> owing_money <span class="token punctuation">(</span>start_date<span class="token punctuation">,</span> end_date<span class="token punctuation">,</span> amount<span class="token punctuation">)</span> <span class="token keyword">VALUES</span>
<span class="token punctuation">(</span><span class="token string">&#39;2015-03-02&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;2015-03-05&#39;</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">(</span><span class="token string">&#39;2015-03-04&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;2015-03-06&#39;</span><span class="token punctuation">,</span> <span class="token number">20</span><span class="token punctuation">)</span>
<span class="token punctuation">;</span>

<span class="token comment">-- 查询每天需要还的金额</span>
<span class="token keyword">SELECT</span> d<span class="token punctuation">.</span><span class="token keyword">date</span>
      <span class="token punctuation">,</span><span class="token function">SUM</span><span class="token punctuation">(</span>t<span class="token punctuation">.</span>amount<span class="token punctuation">)</span> <span class="token keyword">AS</span> daily_amount
<span class="token keyword">FROM</span> <span class="token punctuation">(</span>
      <span class="token keyword">SELECT</span> <span class="token keyword">DATE</span> <span class="token punctuation">(</span><span class="token string">&#39;2015-03-02&#39;</span><span class="token punctuation">)</span> <span class="token keyword">AS</span> <span class="token keyword">date</span>
      <span class="token keyword">UNION</span> <span class="token keyword">ALL</span>
      <span class="token keyword">SELECT</span> <span class="token keyword">DATE</span> <span class="token punctuation">(</span><span class="token string">&#39;2015-03-03&#39;</span><span class="token punctuation">)</span>
      <span class="token keyword">UNION</span> <span class="token keyword">ALL</span>
      <span class="token keyword">SELECT</span> <span class="token keyword">DATE</span> <span class="token punctuation">(</span><span class="token string">&#39;2015-03-04&#39;</span><span class="token punctuation">)</span>
      <span class="token keyword">UNION</span> <span class="token keyword">ALL</span>
      <span class="token keyword">SELECT</span> <span class="token keyword">DATE</span> <span class="token punctuation">(</span><span class="token string">&#39;2015-03-05&#39;</span><span class="token punctuation">)</span>
      <span class="token keyword">UNION</span> <span class="token keyword">ALL</span>
      <span class="token keyword">SELECT</span> <span class="token keyword">DATE</span> <span class="token punctuation">(</span><span class="token string">&#39;2015-03-06&#39;</span><span class="token punctuation">)</span>
     <span class="token punctuation">)</span> d <span class="token comment">-- 创建日期序列</span>
<span class="token keyword">LEFT</span> <span class="token keyword">JOIN</span> owing_money t
       <span class="token keyword">ON</span> d<span class="token punctuation">.</span><span class="token keyword">date</span> <span class="token operator">BETWEEN</span> t<span class="token punctuation">.</span>start_date <span class="token operator">AND</span> t<span class="token punctuation">.</span>end_date
<span class="token keyword">GROUP</span> <span class="token keyword">BY</span> d<span class="token punctuation">.</span><span class="token keyword">date</span>
<span class="token keyword">ORDER</span> <span class="token keyword">BY</span> d<span class="token punctuation">.</span><span class="token keyword">date</span>
<span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="区间筛选问题" tabindex="-1"><a class="header-anchor" href="#区间筛选问题" aria-hidden="true">#</a> 区间筛选问题</h2><h3 id="快递停留问题" tabindex="-1"><a class="header-anchor" href="#快递停留问题" aria-hidden="true">#</a> 快递停留问题</h3><blockquote><p>有一个表记录一个网点所有快递到达和离开的时间，如果离开时间不等于到达时间则代表这个运单在这个网点有停留，统计出表中在 2018-03-01 13:00 到 2018-03-01 15:00 之间在该网点有停留的运单数</p></blockquote><div class="language-sql line-numbers-mode" data-ext="sql"><pre class="language-sql"><code><span class="token comment">-- 数据准备</span>
<span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> DD<span class="token punctuation">(</span>
                WAYBILLNO  NUMBER<span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span>
               <span class="token punctuation">,</span>ARR_TIME   <span class="token keyword">DATE</span>
               <span class="token punctuation">,</span>LEAVE_TIME <span class="token keyword">DATE</span>
               <span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> DD <span class="token keyword">VALUES</span> <span class="token punctuation">(</span><span class="token number">1</span>
                      <span class="token punctuation">,</span>TO_DATE<span class="token punctuation">(</span><span class="token string">&#39;2018-03-01 12:40:10&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;YYYY-MM-DD HH24:MI:SS&#39;</span><span class="token punctuation">)</span>
                      <span class="token punctuation">,</span>TO_DATE<span class="token punctuation">(</span><span class="token string">&#39;2018-03-01 13:50:10&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;YYYY-MM-DD HH24:MI:SS&#39;</span><span class="token punctuation">)</span>
                      <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> DD <span class="token keyword">VALUES</span> <span class="token punctuation">(</span><span class="token number">2</span>
                      <span class="token punctuation">,</span>TO_DATE<span class="token punctuation">(</span><span class="token string">&#39;2018-03-01 11:29:45&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;YYYY-MM-DD HH24:MI:SS&#39;</span><span class="token punctuation">)</span>
                      <span class="token punctuation">,</span>TO_DATE<span class="token punctuation">(</span><span class="token string">&#39;2018-03-01 12:40:18&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;YYYY-MM-DD HH24:MI:SS&#39;</span><span class="token punctuation">)</span>
                      <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> DD <span class="token keyword">VALUES</span> <span class="token punctuation">(</span><span class="token number">3</span>
                      <span class="token punctuation">,</span>TO_DATE<span class="token punctuation">(</span><span class="token string">&#39;2018-03-01 14:35:10&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;YYYY-MM-DD HH24:MI:SS&#39;</span><span class="token punctuation">)</span>
                      <span class="token punctuation">,</span>TO_DATE<span class="token punctuation">(</span><span class="token string">&#39;2018-03-01 16:00:00&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;YYYY-MM-DD HH24:MI:SS&#39;</span><span class="token punctuation">)</span>
                      <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">COMMIT</span><span class="token punctuation">;</span>

<span class="token comment">-- 统计停留的运单数</span>
<span class="token keyword">SELECT</span> <span class="token function">COUNT</span><span class="token punctuation">(</span>T<span class="token punctuation">.</span>WAYBILLNO<span class="token punctuation">)</span> 运单数
<span class="token keyword">FROM</span> DD T
<span class="token keyword">WHERE</span> T<span class="token punctuation">.</span>ARR_TIME <span class="token operator">!=</span> T<span class="token punctuation">.</span>LEAVE_TIME
  <span class="token operator">AND</span> T<span class="token punctuation">.</span>ARR_TIME <span class="token operator">&lt;=</span> TO_DATE<span class="token punctuation">(</span><span class="token number">201803011500</span><span class="token punctuation">,</span><span class="token string">&#39;YYYYMMDDHH24MI&#39;</span><span class="token punctuation">)</span>
  <span class="token operator">AND</span> T<span class="token punctuation">.</span>LEAVE_TIME <span class="token operator">&gt;=</span> TO_DATE<span class="token punctuation">(</span><span class="token number">201803011300</span><span class="token punctuation">,</span><span class="token string">&#39;YYYYMMDDHH24MI&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="交叉日期筛选" tabindex="-1"><a class="header-anchor" href="#交叉日期筛选" aria-hidden="true">#</a> 交叉日期筛选</h3><blockquote><p>编写 SQL 语句查询同一保单有效起始日期～有效结束日期存在交叉的保单明细记录</p></blockquote><div class="language-sql line-numbers-mode" data-ext="sql"><pre class="language-sql"><code><span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> F_TABLE
<span class="token punctuation">(</span>
  COMPANY    VARCHAR2<span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span>   <span class="token comment">-- 公司 主健</span>
<span class="token punctuation">,</span> AGENCYID   VARCHAR2<span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span>  <span class="token comment">-- 工号 主健</span>
<span class="token punctuation">,</span> POLICYCODE VARCHAR2<span class="token punctuation">(</span><span class="token number">8</span><span class="token punctuation">)</span>   <span class="token comment">-- 保单号 主健</span>
<span class="token punctuation">,</span> CBDATE     NUMBER<span class="token punctuation">(</span><span class="token number">8</span><span class="token punctuation">)</span>     <span class="token comment">-- 承保日期</span>
<span class="token punctuation">,</span> COWNUM     VARCHAR2<span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span>  <span class="token comment">-- 投保人</span>
<span class="token punctuation">,</span> EF         <span class="token keyword">DATE</span>          <span class="token comment">-- 有效起始日期 主健</span>
<span class="token punctuation">,</span> ET         <span class="token keyword">DATE</span>          <span class="token comment">-- 有效结束日期</span>
<span class="token punctuation">,</span> <span class="token keyword">PRIMARY</span> <span class="token keyword">KEY</span><span class="token punctuation">(</span>COMPANY<span class="token punctuation">,</span> AGENCYID<span class="token punctuation">,</span> POLICYCODE<span class="token punctuation">,</span> EF<span class="token punctuation">)</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> F_TABLE <span class="token keyword">VALUES</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token string">&#39;001&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;0000003&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;20061201&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;wang&#39;</span><span class="token punctuation">,</span> TO_DATE<span class="token punctuation">(</span><span class="token string">&#39;19000101&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;YYYYMMDD&#39;</span><span class="token punctuation">)</span><span class="token punctuation">,</span> TO_DATE<span class="token punctuation">(</span><span class="token string">&#39;20001220&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;YYYYMMDD&#39;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> F_TABLE <span class="token keyword">VALUES</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token string">&#39;001&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;0000003&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;20070101&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;wang&#39;</span><span class="token punctuation">,</span> TO_DATE<span class="token punctuation">(</span><span class="token string">&#39;20001221&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;YYYYMMDD&#39;</span><span class="token punctuation">)</span><span class="token punctuation">,</span> TO_DATE<span class="token punctuation">(</span><span class="token string">&#39;99991231&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;YYYYMMDD&#39;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> F_TABLE <span class="token keyword">VALUES</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token string">&#39;001&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;0000004&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;20061201&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;li&#39;</span><span class="token punctuation">,</span> TO_DATE<span class="token punctuation">(</span><span class="token string">&#39;19000101&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;YYYYMMDD&#39;</span><span class="token punctuation">)</span><span class="token punctuation">,</span> TO_DATE<span class="token punctuation">(</span><span class="token string">&#39;20001220&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;YYYYMMDD&#39;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> F_TABLE <span class="token keyword">VALUES</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token string">&#39;001&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;0000004&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;20061201&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;li&#39;</span><span class="token punctuation">,</span> TO_DATE<span class="token punctuation">(</span><span class="token string">&#39;20001221&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;YYYYMMDD&#39;</span><span class="token punctuation">)</span><span class="token punctuation">,</span> TO_DATE<span class="token punctuation">(</span><span class="token string">&#39;20001230&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;YYYYMMDD&#39;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> F_TABLE <span class="token keyword">VALUES</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token string">&#39;001&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;0000004&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;20070101&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;li&#39;</span><span class="token punctuation">,</span> TO_DATE<span class="token punctuation">(</span><span class="token string">&#39;20001230&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;YYYYMMDD&#39;</span><span class="token punctuation">)</span><span class="token punctuation">,</span> TO_DATE<span class="token punctuation">(</span><span class="token string">&#39;99991231&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;YYYYMMDD&#39;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">COMMIT</span><span class="token punctuation">;</span>

<span class="token comment">-- 统计同一保单存在交叉的记录</span>
<span class="token keyword">SELECT</span> F1<span class="token punctuation">.</span><span class="token operator">*</span>
<span class="token keyword">FROM</span> F_TABLE F1
<span class="token keyword">INNER</span> <span class="token keyword">JOIN</span> F_TABLE F2
        <span class="token keyword">ON</span> F1<span class="token punctuation">.</span>POLICYCODE <span class="token operator">=</span> F2<span class="token punctuation">.</span>POLICYCODE
       <span class="token operator">AND</span> F1<span class="token punctuation">.</span>EF <span class="token operator">&lt;=</span> F2<span class="token punctuation">.</span>ET
       <span class="token operator">AND</span> F1<span class="token punctuation">.</span>ET <span class="token operator">&gt;=</span> F2<span class="token punctuation">.</span>EF
       <span class="token operator">AND</span> F1<span class="token punctuation">.</span>EF <span class="token operator">!=</span> F2<span class="token punctuation">.</span>EF
<span class="token keyword">ORDER</span> <span class="token keyword">BY</span> F1<span class="token punctuation">.</span>ET<span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="拉链表利息" tabindex="-1"><a class="header-anchor" href="#拉链表利息" aria-hidden="true">#</a> 拉链表利息</h3><blockquote><p>根据余额拉链历史表，用一个 SQL 计算每个账户 [2020/1/1, 2020/3/31] 期间的利息</p><p>利息 = bal * rate * days / 360</p></blockquote><div class="language-sql line-numbers-mode" data-ext="sql"><pre class="language-sql"><code><span class="token comment">-- 数据准备</span>
<span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> ACCT<span class="token punctuation">(</span>
                  ACCTID VARCHAR2<span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span>
                 <span class="token punctuation">,</span>BAL    NUMBER
                 <span class="token punctuation">,</span>RATE   NUMBER<span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span>
                 <span class="token punctuation">,</span>ST     <span class="token keyword">DATE</span>
                 <span class="token punctuation">,</span>ET     <span class="token keyword">DATE</span>
                 <span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> ACCT <span class="token keyword">VALUES</span> <span class="token punctuation">(</span><span class="token string">&#39;001&#39;</span><span class="token punctuation">,</span> <span class="token number">500</span><span class="token punctuation">,</span> <span class="token number">0.012</span><span class="token punctuation">,</span> TO_DATE<span class="token punctuation">(</span><span class="token string">&#39;20190101&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;YYYYMMDD&#39;</span><span class="token punctuation">)</span><span class="token punctuation">,</span> TO_DATE<span class="token punctuation">(</span><span class="token string">&#39;20191215&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;YYYYMMDD&#39;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> ACCT <span class="token keyword">VALUES</span> <span class="token punctuation">(</span><span class="token string">&#39;001&#39;</span><span class="token punctuation">,</span> <span class="token number">1000</span><span class="token punctuation">,</span> <span class="token number">0.015</span><span class="token punctuation">,</span> TO_DATE<span class="token punctuation">(</span><span class="token string">&#39;20191215&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;YYYYMMDD&#39;</span><span class="token punctuation">)</span><span class="token punctuation">,</span> TO_DATE<span class="token punctuation">(</span><span class="token string">&#39;20200116&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;YYYYMMDD&#39;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> ACCT <span class="token keyword">VALUES</span> <span class="token punctuation">(</span><span class="token string">&#39;001&#39;</span><span class="token punctuation">,</span> <span class="token number">2000</span><span class="token punctuation">,</span> <span class="token number">0.015</span><span class="token punctuation">,</span> TO_DATE<span class="token punctuation">(</span><span class="token string">&#39;20200116&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;YYYYMMDD&#39;</span><span class="token punctuation">)</span><span class="token punctuation">,</span> TO_DATE<span class="token punctuation">(</span><span class="token string">&#39;30001231&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;YYYYMMDD&#39;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> ACCT <span class="token keyword">VALUES</span> <span class="token punctuation">(</span><span class="token string">&#39;002&#39;</span><span class="token punctuation">,</span> <span class="token number">1500</span><span class="token punctuation">,</span> <span class="token number">0.015</span><span class="token punctuation">,</span> TO_DATE<span class="token punctuation">(</span><span class="token string">&#39;20191231&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;YYYYMMDD&#39;</span><span class="token punctuation">)</span><span class="token punctuation">,</span> TO_DATE<span class="token punctuation">(</span><span class="token string">&#39;20200126&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;YYYYMMDD&#39;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> ACCT <span class="token keyword">VALUES</span> <span class="token punctuation">(</span><span class="token string">&#39;002&#39;</span><span class="token punctuation">,</span> <span class="token number">10000</span><span class="token punctuation">,</span> <span class="token number">0.015</span><span class="token punctuation">,</span> TO_DATE<span class="token punctuation">(</span><span class="token string">&#39;20200126&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;YYYYMMDD&#39;</span><span class="token punctuation">)</span><span class="token punctuation">,</span> TO_DATE<span class="token punctuation">(</span><span class="token string">&#39;20200306&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;YYYYMMDD&#39;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> ACCT <span class="token keyword">VALUES</span> <span class="token punctuation">(</span><span class="token string">&#39;002&#39;</span><span class="token punctuation">,</span> <span class="token number">900</span><span class="token punctuation">,</span> <span class="token number">0.015</span><span class="token punctuation">,</span> TO_DATE<span class="token punctuation">(</span><span class="token string">&#39;20200306&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;YYYYMMDD&#39;</span><span class="token punctuation">)</span><span class="token punctuation">,</span> TO_DATE<span class="token punctuation">(</span><span class="token string">&#39;30001231&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;YYYYMMDD&#39;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">COMMIT</span><span class="token punctuation">;</span>

<span class="token comment">-- 计算利息</span>
<span class="token keyword">SELECT</span> <span class="token keyword">DISTINCT</span> T1<span class="token punctuation">.</span>ACCTID
      <span class="token punctuation">,</span><span class="token function">ROUND</span><span class="token punctuation">(</span><span class="token function">SUM</span><span class="token punctuation">(</span>T1<span class="token punctuation">.</span>BAL <span class="token operator">*</span> T1<span class="token punctuation">.</span>RATE <span class="token operator">*</span> <span class="token punctuation">(</span>T1<span class="token punctuation">.</span>REAL_ET <span class="token operator">-</span> T1<span class="token punctuation">.</span>REAL_ST<span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token number">360</span><span class="token punctuation">)</span> <span class="token keyword">OVER</span> <span class="token punctuation">(</span><span class="token keyword">PARTITION</span> <span class="token keyword">BY</span> T1<span class="token punctuation">.</span>ACCTID<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span> <span class="token keyword">INT</span>
<span class="token keyword">FROM</span> <span class="token punctuation">(</span>
      <span class="token keyword">SELECT</span> T<span class="token punctuation">.</span><span class="token operator">*</span>
            <span class="token punctuation">,</span><span class="token keyword">CASE</span> <span class="token keyword">WHEN</span> T<span class="token punctuation">.</span>ST <span class="token operator">&lt;=</span> TO_DATE<span class="token punctuation">(</span><span class="token string">&#39;20200101&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;YYYYMMDD&#39;</span><span class="token punctuation">)</span> <span class="token keyword">THEN</span> TO_DATE<span class="token punctuation">(</span><span class="token string">&#39;20200101&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;YYYYMMDD&#39;</span><span class="token punctuation">)</span>
                  <span class="token keyword">ELSE</span> T<span class="token punctuation">.</span>ST
             <span class="token keyword">END</span> REAL_ST
            <span class="token punctuation">,</span><span class="token keyword">CASE</span> <span class="token keyword">WHEN</span> T<span class="token punctuation">.</span>ET <span class="token operator">&gt;=</span> TO_DATE<span class="token punctuation">(</span><span class="token string">&#39;20200331&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;YYYYMMDD&#39;</span><span class="token punctuation">)</span> <span class="token keyword">THEN</span> TO_DATE<span class="token punctuation">(</span><span class="token string">&#39;20200401&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;YYYYMMDD&#39;</span><span class="token punctuation">)</span>
                  <span class="token keyword">ELSE</span> T<span class="token punctuation">.</span>ET
             <span class="token keyword">END</span> REAL_ET
      <span class="token keyword">FROM</span> ACCT T
      <span class="token keyword">WHERE</span> T<span class="token punctuation">.</span>ST <span class="token operator">&lt;=</span> TO_DATE<span class="token punctuation">(</span><span class="token string">&#39;20200331&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;YYYYMMDD&#39;</span><span class="token punctuation">)</span> <span class="token operator">AND</span> T<span class="token punctuation">.</span>ET <span class="token operator">&gt;=</span> TO_DATE<span class="token punctuation">(</span><span class="token string">&#39;20200101&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;YYYYMMDD&#39;</span><span class="token punctuation">)</span>
     <span class="token punctuation">)</span> T1<span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="group-by-grouping-sets" tabindex="-1"><a class="header-anchor" href="#group-by-grouping-sets" aria-hidden="true">#</a> GROUP BY GROUPING SETS</h2><blockquote><p>要求：对于scott.emp表，查询各部门sal大于2000的员工，进行汇总，得到各个部门的sal总和以及所有部门的sal总和</p></blockquote><div class="language-sql line-numbers-mode" data-ext="sql"><pre class="language-sql"><code><span class="token keyword">SELECT</span> <span class="token keyword">CASE</span> <span class="token keyword">WHEN</span> T<span class="token punctuation">.</span>DEPTNO <span class="token operator">IS</span> <span class="token boolean">NULL</span> <span class="token keyword">THEN</span> <span class="token string">&#39;合计&#39;</span>
            <span class="token keyword">WHEN</span> T<span class="token punctuation">.</span>DEPTNO <span class="token operator">IS</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token operator">AND</span> T<span class="token punctuation">.</span>EMPNO <span class="token operator">IS</span> <span class="token boolean">NULL</span> <span class="token keyword">THEN</span> <span class="token string">&#39;小计&#39;</span>
            <span class="token keyword">ELSE</span> <span class="token string">&#39;&#39;</span> <span class="token operator">||</span> T<span class="token punctuation">.</span>DEPTNO
       <span class="token keyword">END</span> DEPTNO
     <span class="token punctuation">,</span> T<span class="token punctuation">.</span>EMPNO<span class="token punctuation">,</span> T<span class="token punctuation">.</span>ENAME<span class="token punctuation">,</span> <span class="token function">SUM</span><span class="token punctuation">(</span>T<span class="token punctuation">.</span>SAL<span class="token punctuation">)</span> TOTAL_SAL
<span class="token keyword">FROM</span> EMP T
<span class="token keyword">WHERE</span> T<span class="token punctuation">.</span>SAL <span class="token operator">&gt;</span> <span class="token number">2000</span>
<span class="token keyword">GROUP</span> <span class="token keyword">BY</span> GROUPING SETS<span class="token punctuation">(</span><span class="token punctuation">(</span>T<span class="token punctuation">.</span>DEPTNO<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>T<span class="token punctuation">.</span>DEPTNO<span class="token punctuation">,</span> T<span class="token punctuation">.</span>EMPNO<span class="token punctuation">,</span> T<span class="token punctuation">.</span>ENAME<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div>`,14);function D(g,N){const p=o("ExternalLinkIcon");return e(),c("div",null,[k,l(" more "),r,n("blockquote",null,[d,v,T,m,E,b,y,w,A,n("p",null,[s("参考资料："),n("a",S,[s("MySQL 如何生成连续的数字/字符/时间序列"),u(p)])])]),O])}const _=t(i,[["render",D],["__file","SQL练习题.html.vue"]]);export{_ as default};
